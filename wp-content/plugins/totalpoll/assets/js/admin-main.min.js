jQuery(function(e){var t=e("#tp-wrapper");e.fn.serializeObject=function(){var t={};var i=this.serializeArray();e.each(i,function(){if(void 0!==t[this.name]){if(!t[this.name].push)t[this.name]=[t[this.name]];t[this.name].push(this.value||"")}else t[this.name]=this.value||""});return t};e.fn.initTinyMCE=function(){var t=this[0].id;var i=e.extend(true,{},tinyMCEPreInit.mceInit["totalpoll"]);i.selector="#"+t;tinyMCEPreInit.mceInit[t]=i;tinymce.init(i);quicktags({id:t,buttons:tinyMCEPreInit.qtInit["totalpoll"].buttons});QTags._buttonsInit()};var i={};t.find(".choice-template").each(function(e,t){i[t.id]=function(e){return t.innerHTML.replace(/\{\{index\}\}/g,e)}});t.find("> .section .title").click(function(t){t.preventDefault();var i=e(this);i.prev(".tab-state").attr("checked",i.parent().hasClass("collapsed")?true:false);i.next(".content").slideToggle(function(){e(this).parent().toggleClass("collapsed")})});t.on("click","[data-toggler]",function(t){if("A"==this.tagName)t.preventDefault();e(this).toggleClass("toggled");e('[data-toggle="'+e(this).data("toggler")+'"]').stop().slideToggle(function(){e(this).toggleClass("toggled")})});t.find(".choice-types button").click(function(n){n.preventDefault();var o=i[e(this).data("template")](e(".choices-container > .choice").length);t.find(".choices-container").append(o).trigger("refresh")});t.find(".choices-container").sortable({axis:"y",items:"> .choice",handle:".choice-controllers .move",cancel:"input",containment:"parent",revert:100,tolerance:"pointer",placeholder:"choice-sortable-placeholder",forceHelperSize:true,forcePlaceholderSize:true,update:function(){t.find(".choices-container > .choice").trigger("refresh")}});t.find(".choices-container").on("refresh",function(){if("undefined"!==typeof tinymce.editors)e(tinymce.editors).each(function(){var t="#wp-"+this.settings.id+"-wrap.tmce-active";this.destroy();setTimeout(function(){e(t).find(".switch-tmce").click()},100)});t.find(".choices-container").sortable("refresh");t.find(".choices-container .choice").each(function(t){e("input, select, textarea",this).attr("name",function(){this.name=this.name.replace(/tp_options\[choices\]\[(\d+)\]/g,function(e,i,n,o){return e.replace(i,t)})})})});t.on("click",".choice .choice-controllers .delete",function(i){i.preventDefault();e(this).closest(".choice").remove();t.find(".choices-container").trigger("refresh")});t.on("click",".choice .choice-controllers .upload",function(t){t.preventDefault();TPMediaUploader.frame().open();e("[data-upload-holder]").removeAttr("data-upload-holder");e(this).closest(".choice").find(".upload-holder").attr("data-upload-holder","")});e(".override-votes").change(function(){e(".choices-container").toggleClass("show-votes-fields")});t.find(".datepicker").each(function(){e(this).datepicker()});if("function"==typeof e.farbtastic){var n='<div class="tp-color-picker"></div>';e(".tp-color-field").focus(function(){e(this).after(n).next(".tp-color-picker").farbtastic(this).slideDown()}).blur(function(){e(this).next(".tp-color-picker").slideUp(function(){e(this).remove()})})}else e(".tp-color-field").wpColorPicker({change:function(){setTimeout(refreshPreview,0)}});e(document).on("change",".need-refresh input, .need-refresh textarea, .need-refresh select",function(){refreshPreview()});window.refreshPreview=function(){var t=e(".preview-pane iframe").contents().find("#preview-variables");e(".need-refresh").find("input, textarea, select").each(function(){e("<textarea></textarea>").addClass("hide").attr({name:e(this).attr("name")}).val(e(this).val()).appendTo(t)});t.submit()};e('select[name="tp_options[template][preset][name]"]').on("change",function(t){if(confirm("Are you sure?")){e('input[name="tp_options[template][preset][load]"]').val(e(this).val());e("#publish").click()}else e(this).val(e(this).find("[selected]").val())});e('button[name="tp_options[template][preset][new]"]').on("click",function(t){e(this).val(prompt("Preset ID"))});e('button[name="tp_options[template][preset][delete]"]').on("click",function(e){if(!confirm("Are you sure?"))e.preventDefault()});t.on("click",".customizer a[data-toggler]:not(.toggled)",function(t){e(".customizer a.toggled").not(this).click()});var o=function(){var i=e(window).scrollTop();var n=t.find(".choices-container");var o=t.find(".choice-types");if(i>n.offset().top){if(i+o.outerHeight()<n.offset().top+n.outerHeight())o.css({marginTop:i-n.offset().top+42})}else o.css({marginTop:0})};e(window).scroll(o);TPMediaUploader={frame:function(){if(this._frame)return this._frame;this._frame=wp.media({title:wp.media.view.l10n.insertMediaTitle,multiple:false,library:{type:"image"}});this._frame.on("ready",this.ready);this._frame.state("library").on("select",this.select);return this._frame},ready:function(){e(".media-modal").addClass("no-sidebar smaller")},select:function(){this.get("selection").map(TPMediaUploader.insertImage)},insertImage:function(t){var i=e("[data-upload-holder]").parent();i.find('input[name*="label"]').val(t.get("title"));i.find("[data-upload-holder]").val(t.get("sizes").thumbnail.url);i.find('input[name*="full"]').val(t.get("sizes").full.url)}}});